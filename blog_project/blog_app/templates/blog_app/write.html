{% load static %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link href="{% static 'css/write.css' %}" rel="stylesheet" />
        <link href="{% static 'summernote/summernote.css' %}" rel="stylesheet">
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="{% static 'summernote/summernote.js' %}"></script>
        <title>Write</title>
    </head>
    <body>
        <header>
            <div>MYLOG</div>
            <div>일상</div>
            <div>요리</div>
            <div>여행</div>
            <div>영화</div>
            <div>IT</div>
            <div>Logout</div>
            <div>Just Write!</div>
        </header>
        <section>
            {% comment %} <form method="post" action="{% url 'write' %}">
                {% csrf_token %}
                {{ write_form.as_table }}
                <button type="submit">등록</button>
            </form> {% endcomment %}
            <form method="post" action="{% url 'write' %}" id="write-form">
                {% csrf_token %}
                {{ write_form.as_table }}
                <button type="submit" id="save-button" name="save_temporary">임시저장</button>
                <button type="submit" id="publish-button" name="publish">등록</button>
            </form>
            <div id="toast-container" class="toast-container">
                <div id="toast-message" class="toast">
                    포스트가 임시 저장되었습니다.
                </div>
            </div>
        </section>
    </body>
    {% comment %} <script>
        $(document).ready(function() {
        $('#id_content').summernote();  // content 필드에 Summernote 적용
        });
    </script> {% endcomment %}
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const toastMessage = document.getElementById("toast-message");
            const writeForm = document.getElementById("write-form");
    
            const showToast = () => {
                toastMessage.style.display = "block";
                setTimeout(() => {
                    toastMessage.style.display = "none";
                }, 5000); // 5초 후에 토스트 메시지를 숨김
            };
    
            if (writeForm) {
                writeForm.addEventListener("submit", (e) => {
                    // 폼 데이터를 FormData 객체로 가져오기
                    const formData = new FormData(writeForm);
    
                    // '임시저장' 버튼이 눌렸는지 확인
                    const saveTemporaryButton = document.querySelector("[name='save_temporary']");
                    if (saveTemporaryButton && e.submitter === saveTemporaryButton) {
                        e.preventDefault(); // 폼 제출을 막음
    
                        // '임시저장' 버튼을 눌렀을 때만 AJAX 요청 보냄
                        fetch("{% url 'save_temporary_post' %}", {
                            method: "POST",
                            body: formData,
                        })
                            .then((response) => response.json())
                            .then((data) => {
                                // 서버에서의 응답을 처리
                                showToast();
                            })
                            .catch((error) => {
                                console.error("에러 발생:", error);
                            });
                    }
                });
            }
        });
    </script>
    
</html>
